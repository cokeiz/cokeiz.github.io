<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="pandas多变量可视化Seaborn的API介绍，以及RFM指标的应用">
<meta property="og:type" content="article">
<meta property="og:title" content="数据可视化，RFM">
<meta property="og:url" content="http://example.com/2025/05/14/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%201ec3311af3f5801682d5fc9c085d70e9/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%EF%BC%8CRFM%201f53311af3f580479ea4c454ec421645/index.html">
<meta property="og:site_name" content="Coke&#39;s Blog">
<meta property="og:description" content="pandas多变量可视化Seaborn的API介绍，以及RFM指标的应用">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-05-14T10:35:00.000Z">
<meta property="article:modified_time" content="2025-05-16T12:39:36.309Z">
<meta property="article:author" content="cokeiz">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="数据处理与统计分析">
<meta property="article:tag" content="jupyterlab">
<meta property="article:tag" content="Pandas">
<meta property="article:tag" content="Matplotlib">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2025/05/14/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%201ec3311af3f5801682d5fc9c085d70e9/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%EF%BC%8CRFM%201f53311af3f580479ea4c454ec421645/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2025/05/14/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%201ec3311af3f5801682d5fc9c085d70e9/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%EF%BC%8CRFM%201f53311af3f580479ea4c454ec421645/","path":"2025/05/14/数据处理与统计分析 1ec3311af3f5801682d5fc9c085d70e9/数据可视化，RFM 1f53311af3f580479ea4c454ec421645/","title":"数据可视化，RFM"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>数据可视化，RFM | Coke's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Coke's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">人生苦短，我用python</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%EF%BC%8CRFM"><span class="nav-number">1.</span> <span class="nav-text">数据可视化，RFM</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8A%E6%97%A5%E9%87%8D%E7%82%B9"><span class="nav-number">1.1.</span> <span class="nav-text">今日重点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Pandas%E5%8F%8C%E5%8F%98%E9%87%8F%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">1.2.</span> <span class="nav-text">1 Pandas双变量可视化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%95%A3%E7%82%B9%E5%9B%BE%E8%9C%82%E5%B7%A2%E5%9B%BE"><span class="nav-number">1.2.1.</span> <span class="nav-text">1 散点图蜂巢图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%A0%86%E5%8F%A0%E5%9B%BE-%E5%A0%86%E5%8F%A0%E6%9F%B1%E7%8A%B6%E5%9B%BE"><span class="nav-number">1.2.2.</span> <span class="nav-text">2 堆叠图- 堆叠柱状图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%A0%86%E5%8F%A0%E9%9D%A2%E7%A7%AF%E5%9B%BE"><span class="nav-number">1.2.3.</span> <span class="nav-text">3 堆叠面积图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%8A%98%E7%BA%BF%E5%9B%BE"><span class="nav-number">1.2.4.</span> <span class="nav-text">4 折线图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Seaborn-%E7%BB%98%E5%9B%BE"><span class="nav-number">1.3.</span> <span class="nav-text">2 Seaborn 绘图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E5%8F%98%E9%87%8F%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">1.3.1.</span> <span class="nav-text">单变量可视化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%92%8CKDE%E5%9B%BE"><span class="nav-number">1.3.2.</span> <span class="nav-text">直方图和KDE图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E6%95%B0%E6%9F%B1%E7%8A%B6%E5%9B%BEcountplot"><span class="nav-number">1.3.3.</span> <span class="nav-text">计数柱状图countplot</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8C%E5%8F%98%E9%87%8F%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">1.3.4.</span> <span class="nav-text">双变量可视化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%95%A3%E7%82%B9%E5%9B%BE"><span class="nav-number">1.3.5.</span> <span class="nav-text">1 散点图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%9C%82%E5%B7%A2%E5%9B%BE"><span class="nav-number">1.3.6.</span> <span class="nav-text">2 蜂巢图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2D-KDE%E5%9B%BE"><span class="nav-number">1.3.7.</span> <span class="nav-text">3 2D KDE图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-barplot"><span class="nav-number">1.3.8.</span> <span class="nav-text">4 barplot</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E7%AE%B1%E7%BA%BF%E5%9B%BE"><span class="nav-number">1.3.9.</span> <span class="nav-text">5 箱线图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%8F%90%E7%90%B4%E5%9B%BE"><span class="nav-number">1.3.10.</span> <span class="nav-text">6 提琴图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E6%88%90%E5%AF%B9%E5%85%B3%E7%B3%BB%E5%9B%BE"><span class="nav-number">1.3.11.</span> <span class="nav-text">7 成对关系图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E5%8F%98%E9%87%8F%E5%8F%AF%E8%A7%86%E5%8C%96%E5%92%8Cstyle%E6%A0%B7%E5%BC%8F"><span class="nav-number">1.3.12.</span> <span class="nav-text">多变量可视化和style样式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Seaborn%E7%BB%98%E5%9B%BE%E5%B0%8F%E7%BB%93"><span class="nav-number">1.3.13.</span> <span class="nav-text">Seaborn绘图小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-RFM"><span class="nav-number">1.4.</span> <span class="nav-text">3 RFM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="nav-number">1.5.</span> <span class="nav-text">步骤：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E8%A6%81%E6%B1%82%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="nav-number">1.5.1.</span> <span class="nav-text">1. 原始数据要求，数据准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97"><span class="nav-number">1.5.2.</span> <span class="nav-text">2. 数据清洗</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%8D%95%E5%8F%98%E9%87%8F%E5%88%86%E6%9E%90"><span class="nav-number">1.5.3.</span> <span class="nav-text">3.单变量分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">1.5.4.</span> <span class="nav-text">4.业务数据可视化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-RFM-%E6%A8%A1%E5%9E%8B%E4%B8%9A%E5%8A%A1%E8%AF%B4%E6%98%8E"><span class="nav-number">1.5.5.</span> <span class="nav-text">3.1 RFM 模型业务说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.5.6.</span> <span class="nav-text">3.2 代码实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1-%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD"><span class="nav-number">1.5.7.</span> <span class="nav-text">3.2.1 数据加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="nav-number">1.5.8.</span> <span class="nav-text">3.2.2 数据处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-3-%E6%B1%87%E6%80%BB%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE"><span class="nav-number">1.5.9.</span> <span class="nav-text">3.2.3 汇总所有数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-4-%E4%BB%A5%E5%B9%B4%E4%B8%BA%E5%91%A8%E6%9C%9F%E8%AE%A1%E7%AE%97RFM"><span class="nav-number">1.5.10.</span> <span class="nav-text">3.2.4 以年为周期计算RFM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-5-RFM%E5%8C%BA%E9%97%B4%E5%88%92%E5%88%86%E5%B9%B6%E4%BF%9D%E5%AD%98RFM%E6%A0%87%E7%AD%BE"><span class="nav-number">1.5.11.</span> <span class="nav-text">3.2.5 RFM区间划分并保存RFM标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-6-RFM%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">1.5.12.</span> <span class="nav-text">3.2.6 RFM数据可视化</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">cokeiz</p>
  <div class="site-description" itemprop="description">用此来记录我的生活和学习笔记以及学习过程</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/14/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%201ec3311af3f5801682d5fc9c085d70e9/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%EF%BC%8CRFM%201f53311af3f580479ea4c454ec421645/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cokeiz">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coke's Blog">
      <meta itemprop="description" content="用此来记录我的生活和学习笔记以及学习过程">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="数据可视化，RFM | Coke's Blog">
      <meta itemprop="description" content="pandas多变量可视化Seaborn的API介绍，以及RFM指标的应用">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          数据可视化，RFM
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-05-14 18:35:00" itemprop="dateCreated datePublished" datetime="2025-05-14T18:35:00+08:00">2025-05-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-05-16 20:39:36" itemprop="dateModified" datetime="2025-05-16T20:39:36+08:00">2025-05-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90/" itemprop="url" rel="index"><span itemprop="name">数据处理与统计分析</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">pandas多变量可视化Seaborn的API介绍，以及RFM指标的应用</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="数据可视化，RFM"><a href="#数据可视化，RFM" class="headerlink" title="数据可视化，RFM"></a>数据可视化，RFM</h1><h2 id="今日重点"><a href="#今日重点" class="headerlink" title="今日重点"></a>今日重点</h2><p><strong>数据可视化</strong></p>
<ul>
<li>pandas多变量可视化</li>
<li>Seaborn的API介绍</li>
</ul>
<p><strong>RFM</strong></p>
<p>业务指标如何转换成代码</p>
<ul>
<li>复购率 &#x3D; 复购的人数&#x2F;总消费人数</li>
</ul>
<p>要按大区和年月日来统计</p>
<ul>
<li><strong>每个</strong>大区<strong>每个</strong>月来消费的会员有<strong>多少</strong><ul>
<li>groupby([大区id, 月份])[‘会员ID’].count() 会员id需要去重 我们算的是人头</li>
</ul>
</li>
<li><strong>每个</strong>大区<strong>每个</strong>月不止一天有消费的会员有<strong>多少</strong><ul>
<li>一天消费多次只计算一次 消费日期和会员ID 去重</li>
<li>groupby([大区id, 月份])[‘会员ID’].count()</li>
</ul>
</li>
</ul>
<p>计数&#x2F;去重计数&#x2F;求和&#x2F;最大&#x2F;最小&#x2F;平均</p>
<ul>
<li>计数&#x2F;去重计数 id</li>
<li>求和 金额&#x2F;件数</li>
</ul>
<h2 id="1-Pandas双变量可视化"><a href="#1-Pandas双变量可视化" class="headerlink" title="1 Pandas双变量可视化"></a>1 Pandas双变量可视化</h2><h3 id="1-散点图蜂巢图"><a href="#1-散点图蜂巢图" class="headerlink" title="1 散点图蜂巢图"></a>1 散点图蜂巢图</h3><ul>
<li>评分跟价格之间是否有关联</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reviews[reviews[<span class="string">&#x27;price&#x27;</span>]&lt;<span class="number">100</span>].sample(<span class="number">100</span>).plot.scatter(x=<span class="string">&#x27;price&#x27;</span>,y=<span class="string">&#x27;points&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reviews[reviews[<span class="string">&#x27;price&#x27;</span>]&lt;<span class="number">100</span>].plot.scatter(x=<span class="string">&#x27;price&#x27;</span>,y=<span class="string">&#x27;points&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当数据量比较大的时候, 散点图不能反应数据的分布情况, 此时可以考虑使用蜂巢图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexbin gridsize 蜂巢网格的大小</span></span><br><span class="line">reviews[reviews[<span class="string">&#x27;price&#x27;</span>]&lt;<span class="number">100</span>].plot.hexbin(x=<span class="string">&#x27;price&#x27;</span>,y=<span class="string">&#x27;points&#x27;</span>,gridsize=<span class="number">15</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-堆叠图-堆叠柱状图"><a href="#2-堆叠图-堆叠柱状图" class="headerlink" title="2 堆叠图- 堆叠柱状图"></a>2 堆叠图- 堆叠柱状图</h3><ul>
<li>找到最受欢迎的前五种葡萄酒种类</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">top_5_variety = reviews[<span class="string">&#x27;variety&#x27;</span>].value_counts().head().index.to_list()</span><br><span class="line"><span class="comment"># isin Series中的元素, 是否在列表范围内,如果在返回True ,不在返回False</span></span><br><span class="line">top_5_wine = reviews[reviews[<span class="string">&#x27;variety&#x27;</span>].isin(top_5_variety)]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top_5_wine.pivot_table(index=<span class="string">&#x27;points&#x27;</span>,columns=[<span class="string">&#x27;variety&#x27;</span>],values=[<span class="string">&#x27;description&#x27;</span>],aggfunc=<span class="string">&#x27;count&#x27;</span>).plot.bar(figsize=(<span class="number">20</span>,<span class="number">8</span>),stacked=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>stacked&#x3D;True 默认是False False的情况下柱子不会堆叠起来</p>
<p>设置为True之后会有堆叠的效果</p>
</blockquote>
<h3 id="3-堆叠面积图"><a href="#3-堆叠面积图" class="headerlink" title="3 堆叠面积图"></a>3 堆叠面积图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top_5_wine.pivot_table(index=<span class="string">&#x27;points&#x27;</span>,columns=[<span class="string">&#x27;variety&#x27;</span>],values=[<span class="string">&#x27;description&#x27;</span>],aggfunc=<span class="string">&#x27;count&#x27;</span>).plot.area(figsize=(<span class="number">16</span>,<span class="number">8</span>))</span><br></pre></td></tr></table></figure>

<h3 id="4-折线图"><a href="#4-折线图" class="headerlink" title="4 折线图"></a>4 折线图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">top_5_wine.pivot_table(index=<span class="string">&#x27;points&#x27;</span>,columns=[<span class="string">&#x27;variety&#x27;</span>],values=[<span class="string">&#x27;description&#x27;</span>],aggfunc=<span class="string">&#x27;count&#x27;</span>).plot(figsize=(<span class="number">16</span>,<span class="number">8</span>),grid=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-Seaborn-绘图"><a href="#2-Seaborn-绘图" class="headerlink" title="2 Seaborn 绘图"></a>2 Seaborn 绘图</h2><h3 id="单变量可视化"><a href="#单变量可视化" class="headerlink" title="单变量可视化"></a>单变量可视化</h3><h3 id="直方图和KDE图"><a href="#直方图和KDE图" class="headerlink" title="直方图和KDE图"></a>直方图和KDE图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line">tips = pd.read_csv(<span class="string">&#x27;data/tips.csv&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>seaborn 通用的几个参数</p>
<ul>
<li>data 传入一个df 对象</li>
<li>x , y df中的列名</li>
<li>hue 传入一个类别型的列名, 同样的图会按照这个类别, 分组, 分别绘制一份绘制到一起方便进行对比</li>
</ul>
<p>seaborn 调整图的大小</p>
<ul>
<li>plt.subplots(figsize&#x3D;())</li>
<li>如果plt.subplots(figsize&#x3D;()) 不行, 都会有一个height的参数, 指定图片的高度 可以通过height 调整图片大小</li>
<li>height 高度 aspect 宽高比例</li>
</ul>
<p>绘制直方图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>]=[<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line">fig,ax = plt.subplots(figsize=(<span class="number">12</span>,<span class="number">6</span>))</span><br><span class="line">sns.histplot(x=<span class="string">&#x27;total_bill&#x27;</span>,data=tips,hue=<span class="string">&#x27;sex&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;总账单直方图&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>绘制KDE图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span> <span class="comment"># 正常显示负号</span></span><br><span class="line">fig,ax = plt.subplots(figsize=(<span class="number">12</span>,<span class="number">6</span>))</span><br><span class="line">sns.kdeplot(data=tips,x=<span class="string">&#x27;total_bill&#x27;</span>,hue=<span class="string">&#x27;day&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>KDE V.S. 直方图</strong></p>
<ul>
<li>表示的意义基本一样, 都是 线&#x2F;柱子越高 出现的概率&#x2F;样本数量越大&#x2F;越高</li>
<li>KDE 当多个类别进行对比的时候, 读图比直方图方便</li>
<li>Y轴的坐标, KDE图是概率密度 直方图是样本数量</li>
</ul>
<p><strong>Seaborn API 数据传入的两种方式</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果 data 传入了 一个dataframe  x , y 就可以只传入列名的字符串</span></span><br><span class="line">sns.kdeplot(data = tips,x=<span class="string">&#x27;total_bill&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># x 也可以直接赋值一个Series 此时 data 就不需要传参</span></span><br><span class="line">sns.kdeplot(tips[<span class="string">&#x27;total_bill&#x27;</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="计数柱状图countplot"><a href="#计数柱状图countplot" class="headerlink" title="计数柱状图countplot"></a>计数柱状图countplot</h3><p>这个api 体现了Seaborn这一套API另外的一个特点</p>
<ul>
<li>除了绘图以外还会帮助做一些统计</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fig,ax = plt.subplots(figsize=(<span class="number">12</span>,<span class="number">6</span>))</span><br><span class="line">sns.countplot(data=tips,x=<span class="string">&#x27;day&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;计数柱状图&#x27;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用day 进行分组, 然后再计数, 把计数的结果绘制成柱状图, 同下面代码效果类似</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tips[<span class="string">&#x27;day&#x27;</span>].value_counts().plot.bar(color=[<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;orange&#x27;</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="双变量可视化"><a href="#双变量可视化" class="headerlink" title="双变量可视化"></a>双变量可视化</h3><h3 id="1-散点图"><a href="#1-散点图" class="headerlink" title="1 散点图"></a>1 散点图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fig,ax = plt.subplots(figsize=(<span class="number">12</span>,<span class="number">6</span>))</span><br><span class="line">sns.scatterplot(data=tips,x=<span class="string">&#x27;total_bill&#x27;</span>,y=<span class="string">&#x27;tip&#x27;</span>,hue=<span class="string">&#x27;sex&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;总账小费之间关系图&#x27;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fig,ax = plt.subplots(figsize=(<span class="number">12</span>,<span class="number">6</span>))</span><br><span class="line"><span class="comment"># fit_reg 默认是True 会拟合一条直线 就是利用这一份数据跑了线性回归</span></span><br><span class="line"><span class="comment"># fit_reg=False 可以关掉</span></span><br><span class="line">sns.regplot(data=tips,x=<span class="string">&#x27;total_bill&#x27;</span>,y=<span class="string">&#x27;tip&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;总账小费之间关系图&#x27;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-蜂巢图"><a href="#2-蜂巢图" class="headerlink" title="2 蜂巢图"></a>2 蜂巢图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns.jointplot(data=tips,x=<span class="string">&#x27;total_bill&#x27;</span>,y=<span class="string">&#x27;tip&#x27;</span>,kind=<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>kind&#x3D;’hex’  加上这个参数就是蜂巢图, 如果不加就是散点图</p>
</blockquote>
<h3 id="3-2D-KDE图"><a href="#3-2D-KDE图" class="headerlink" title="3 2D KDE图"></a>3 2D KDE图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果为真，则在双变量图中添加颜色条以注释颜色映射。</span></span><br><span class="line">sns.kdeplot(data = tips,x = <span class="string">&#x27;total_bill&#x27;</span>,y = <span class="string">&#x27;tip&#x27;</span>,fill=<span class="literal">True</span>,cbar=<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一维KDE 只传入x, 或者 只转入Y</p>
<p>二维KDE x,y 都传入</p>
<p>fill&#x3D;True   是否填充曲线内的颜色</p>
<p>cbar&#x3D;True  是否显示 右侧的颜色示意条</p>
</blockquote>
<h3 id="4-barplot"><a href="#4-barplot" class="headerlink" title="4 barplot"></a>4 barplot</h3><p>barplot 是对 x 分组 , 对y聚合, 聚合函数 通过estimator传入, 默认是mean 平均</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># barplot</span></span><br><span class="line"><span class="comment"># fit_reg 默认是True 会拟合一条直线 就是利用这一份数据跑了线性回归</span></span><br><span class="line"><span class="comment"># fit_reg=False 可以关掉</span></span><br><span class="line">fig,ax = plt.subplots(figsize = (<span class="number">16</span>,<span class="number">8</span>))</span><br><span class="line">sns.barplot(data = tips,x = <span class="string">&#x27;time&#x27;</span>,y = <span class="string">&#x27;total_bill&#x27;</span>,estimator=<span class="string">&#x27;mean&#x27;</span>,errorbar=<span class="literal">None</span>,hue = <span class="string">&#x27;time&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;总账与小费之间的关系&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>errorbar 误差条, 默认会显示, 当数据是从大量数据中抽样出来的, 此时计算的结果可能不能真正代表全部的数据, 会有一个可能的统计范围, 这个范围就通过这个errorbar来显示, 如果数据不是抽样的数据, 可以把它关了,</p>
<p>上面的代码相当于</p>
<p>tips.groupby(‘time’)[‘total_bill’].mean().plot.bar()</p>
</blockquote>
<h3 id="5-箱线图"><a href="#5-箱线图" class="headerlink" title="5 箱线图"></a>5 箱线图</h3><p>箱线图读图</p>
<ul>
<li>箱子的中间有一条线，代表了数据的中位数</li>
<li>箱子的上下底，分别是数据的上四分位数（Q3）和下四分位数（Q1）</li>
<li>箱体包含了50%的数据。因此，箱子的高度在一定程度上反映了数据的波动程度</li>
<li>上下边缘则代表了该组数据的最大值和最小值<ul>
<li>IQR &#x3D; 上四分位数（Q3) - 下四分位数（Q1）</li>
<li>判断异常值时最大值 &#x3D; 上四分位数（Q3) + 1.5 IQR 大于这个值的就是异常值</li>
<li>判断异常值时最小值 &#x3D; 下四分位数（Q1）- 1.5 IQR 小于这个值的就是异常值</li>
</ul>
</li>
<li>有时候箱子外部会有一些点，可以理解为数据中的“异常值”</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fig,ax = plt.subplots(figsize=(<span class="number">12</span>,<span class="number">6</span>))</span><br><span class="line">sns.boxplot(data=tips,x=<span class="string">&#x27;time&#x27;</span>,y=<span class="string">&#x27;total_bill&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;总账小费之间关系图&#x27;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
</blockquote>
<h3 id="6-提琴图"><a href="#6-提琴图" class="headerlink" title="6 提琴图"></a>6 提琴图</h3><p>相当于是箱线图的增强版</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fig,ax = plt.subplots(figsize=(<span class="number">12</span>,<span class="number">6</span>))</span><br><span class="line">sns.violinplot(data=tips,x=<span class="string">&#x27;time&#x27;</span>,y=<span class="string">&#x27;total_bill&#x27;</span>,hue=<span class="string">&#x27;sex&#x27;</span>,split=<span class="literal">True</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;总账午餐晚餐性别之间关系图&#x27;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>split &#x3D; True 默认是False  当使用hue的时候会生效</p>
<p>会在一个violin中切开 一半显示一个类别</p>
</blockquote>
<h3 id="7-成对关系图"><a href="#7-成对关系图" class="headerlink" title="7 成对关系图"></a>7 成对关系图</h3><p>pairplot</p>
<ul>
<li><code>sns.pairplot(tips,hue=&#39;sex&#39;)</code></li>
</ul>
<blockquote>
<p>默认对角线是直方图, 其它都是散点图, 默认情况下, 右上和左下图标的信息是一样的</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pair_grid = sns.PairGrid(tips)</span><br><span class="line"><span class="comment"># 右上角</span></span><br><span class="line">pair_grid.map_upper(sns.regplot)</span><br><span class="line"><span class="comment"># 左下角</span></span><br><span class="line">pair_grid.map_lower(sns.kdeplot)</span><br><span class="line"><span class="comment"># 对角线</span></span><br><span class="line">pair_grid.map_diag(sns.histplot)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="多变量可视化和style样式"><a href="#多变量可视化和style样式" class="headerlink" title="多变量可视化和style样式"></a>多变量可视化和style样式</h3><p>hue 参数 可以多加一个类别的变量, 用颜色进行区分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># white, dark, whitegrid, darkgrid, ticks</span></span><br><span class="line">sns.set_style(<span class="string">&#x27;ticks&#x27;</span>)</span><br><span class="line">fig,ax = plt.subplots(figsize=(<span class="number">12</span>,<span class="number">6</span>))</span><br><span class="line"><span class="comment"># fit_reg 默认是True 会拟合一条直线 就是利用这一份数据跑了线性回归</span></span><br><span class="line"><span class="comment"># fit_reg=False 可以关掉</span></span><br><span class="line">sns.violinplot(data=tips,x=<span class="string">&#x27;time&#x27;</span>,y=<span class="string">&#x27;total_bill&#x27;</span>,hue=<span class="string">&#x27;sex&#x27;</span>,split=<span class="literal">True</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;总账小费之间关系图&#x27;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Seaborn绘图小结"><a href="#Seaborn绘图小结" class="headerlink" title="Seaborn绘图小结"></a>Seaborn绘图小结</h3><p>sns.XXXplot(data &#x3D; df, x &#x3D; ‘列名’, y&#x3D;’列名’,hue&#x3D;’列名’)</p>
<ul>
<li>调整绘图区域的大小<ul>
<li>plt.subplots(figsize&#x3D;())</li>
<li>如果plt.subplots(figsize&#x3D;()) 不行, 都会有一个height的参数, 指定图片的高度 可以通过height 调整图片大小</li>
<li>height 高度 aspect 宽高比例</li>
</ul>
</li>
</ul>
<h2 id="3-RFM"><a href="#3-RFM" class="headerlink" title="3 RFM"></a>3 RFM</h2><h2 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h2><h3 id="1-原始数据要求，数据准备"><a href="#1-原始数据要求，数据准备" class="headerlink" title="1. 原始数据要求，数据准备"></a>1. 原始数据要求，数据准备</h3><ul>
<li><strong>必需字段</strong>：<ul>
<li><code>客户ID</code>：唯一标识符 (e.g. <code>C1001</code>)</li>
<li><code>订单日期</code>：精确到天 (e.g. <code>2024-03-15</code>)</li>
<li><code>订单金额</code>：含商品单价&#x2F;数量的总金额 (e.g. <code>299.00</code>)</li>
</ul>
</li>
</ul>
<h3 id="2-数据清洗"><a href="#2-数据清洗" class="headerlink" title="2. 数据清洗"></a>2. 数据清洗</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例清洗操作</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;sales_data.csv&#x27;</span>)</span><br><span class="line">df = df.drop_duplicates()  <span class="comment"># 去重</span></span><br><span class="line">df = df[df[<span class="string">&#x27;订单金额&#x27;</span>] &gt; <span class="number">0</span>]  <span class="comment"># 过滤无效订单</span></span><br><span class="line">df[<span class="string">&#x27;订单日期&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;订单日期&#x27;</span>])  <span class="comment"># 统一日期格式</span></span><br></pre></td></tr></table></figure>

<h3 id="3-单变量分析"><a href="#3-单变量分析" class="headerlink" title="3.单变量分析"></a>3.单变量分析</h3><h3 id="4-业务数据可视化"><a href="#4-业务数据可视化" class="headerlink" title="4.业务数据可视化"></a>4.业务数据可视化</h3><h3 id="3-1-RFM-模型业务说明"><a href="#3-1-RFM-模型业务说明" class="headerlink" title="3.1 RFM 模型业务说明"></a>3.1 RFM 模型业务说明</h3><p>R recency       最近一次购买距今的时间间隔      7天以内来过  高  |  低</p>
<p>F frequency    最近一段时间购买的次数         最近半年来过25次   高|低</p>
<p>M monetary   最近一段时间购买的金额         最近半年消费5千元   高|低</p>
<p>RFM 计算</p>
<ul>
<li>R&#x2F;F&#x2F;M 每个维度做二分 分成8组</li>
<li>R&#x2F;F&#x2F;M 每个维度打3分 3&#x2F;2&#x2F;1 333 111</li>
</ul>
<p>RFM 计算要使用到什么样的数据</p>
<p>有用户ID 的交易流水信息就可以了</p>
<ul>
<li>用户ID</li>
<li>消费时间</li>
<li>消费金额</li>
</ul>
<p>计算方法</p>
<ul>
<li>R 最近一次购买距今的时间间隔 用户ID分组对消费时间取最大值 和今天的日期计算差值</li>
<li>F 用户ID分组对消费的记录计数 count</li>
<li>M 用户ID分组对消费金额求和 sum</li>
</ul>
<p>设置打分的规则, 将R&#x2F;F&#x2F;M 每一个维度打分 3&#x2F;2&#x2F;1</p>
<p>把三个分数拼到一起, 就是最后的标签</p>
<p>把数据保存到Mysql中, 保存到Excel</p>
<p>每个组的数据进行可视化</p>
<p>RFM 适合落地的场景</p>
<ul>
<li>有消费M, 消费的频率还不能太低(F不能太小)<ul>
<li>电商&#x2F;打车&#x2F;旅游&#x2F;外卖…..</li>
</ul>
</li>
<li>没有M, 但是用户的使用频率很高, 可以使用RFE E表示参与度<ul>
<li>E 点赞,收藏, 评论, 分享, 弹幕…..</li>
</ul>
</li>
</ul>
<h3 id="3-2-代码实现"><a href="#3-2-代码实现" class="headerlink" title="3.2 代码实现"></a>3.2 代码实现</h3><h3 id="3-2-1-数据加载"><a href="#3-2-1-数据加载" class="headerlink" title="3.2.1 数据加载"></a>3.2.1 数据加载</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">pd.read_excel(<span class="string">&#x27;sales.xlsx&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>我们的数据有5个sheet，只传路径只能读取出一个sheet, 查看api 文档后发现有一个sheet_name参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sheet_names = [<span class="string">&#x27;2015&#x27;</span>,<span class="string">&#x27;2016&#x27;</span>,<span class="string">&#x27;2017&#x27;</span>,<span class="string">&#x27;2018&#x27;</span>,<span class="string">&#x27;会员等级&#x27;</span>]</span><br><span class="line">sheet_datas = pd.read_excel(<span class="string">&#x27;sales.xlsx&#x27;</span>,sheet_name=sheet_names)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>添加sheet_name参数后，返回的是一个字典， key是sheet的名字，返回的value是对应的DataFrame</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sheet_datas[<span class="string">&#x27;2016&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>遍历整个字典， 查看每个sheet的基本情况</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sheet_names:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;===============&#x27;</span>+i+<span class="string">&#x27;start======================================&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(sheet_datas[i].head())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----------------------HEAD----------------------------------&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(sheet_datas[i].info())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-----------------------INFO--------------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(sheet_datas[i].describe())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;======================OVER===========================&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">===============2015start======================================</span><br><span class="line">          会员ID         订单号       提交日期    订单金额</span><br><span class="line">0  15278002468  3000304681 2015-01-01   499.0</span><br><span class="line">1  39236378972  3000305791 2015-01-01  2588.0</span><br><span class="line">2  38722039578  3000641787 2015-01-01   498.0</span><br><span class="line">3  11049640063  3000798913 2015-01-01  1572.0</span><br><span class="line">4  35038752292  3000821546 2015-01-01    10.1</span><br><span class="line">----------------------HEAD----------------------------------</span><br><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 30774 entries, 0 to 30773</span><br><span class="line">Data columns (total 4 columns):</span><br><span class="line"> #   Column  Non-Null Count  Dtype</span><br><span class="line">---  ------  --------------  -----</span><br><span class="line"> 0   会员ID    30774 non-null  int64</span><br><span class="line"> 1   订单号     30774 non-null  int64</span><br><span class="line"> 2   提交日期    30774 non-null  datetime64[ns]</span><br><span class="line"> 3   订单金额    30774 non-null  float64</span><br><span class="line">dtypes: datetime64[ns](1), float64(1), int64(2)</span><br><span class="line">memory usage: 961.8 KB</span><br><span class="line">None</span><br><span class="line">-----------------------INFO--------------------------------</span><br><span class="line">               会员ID           订单号           订单金额</span><br><span class="line">count  3.077400e+04  3.077400e+04   30774.000000</span><br><span class="line">mean   2.918779e+10  4.020414e+09     960.991161</span><br><span class="line">std    1.385333e+10  2.630510e+08    2068.107231</span><br><span class="line">min    2.670000e+02  3.000305e+09       0.500000</span><br><span class="line">25%    1.944122e+10  3.885510e+09      59.000000</span><br><span class="line">50%    3.746545e+10  4.117491e+09     139.000000</span><br><span class="line">75%    3.923593e+10  4.234882e+09     899.000000</span><br><span class="line">max    3.954613e+10  4.282025e+09  111750.000000</span><br><span class="line">======================OVER===========================</span><br><span class="line">===============2016start======================================</span><br><span class="line">          会员ID         订单号       提交日期    订单金额</span><br><span class="line">0  39288120141  4282025766 2016-01-01    76.0</span><br><span class="line">1  39293812118  4282037929 2016-01-01  7599.0</span><br><span class="line">2  27596340905  4282038740 2016-01-01   802.0</span><br><span class="line">3  15111475509  4282043819 2016-01-01    65.0</span><br><span class="line">4  38896594001  4282051044 2016-01-01    95.0</span><br><span class="line">----------------------HEAD----------------------------------</span><br><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 41278 entries, 0 to 41277</span><br><span class="line">Data columns (total 4 columns):</span><br><span class="line"> #   Column  Non-Null Count  Dtype</span><br><span class="line">---  ------  --------------  -----</span><br><span class="line"> 0   会员ID    41278 non-null  int64</span><br><span class="line"> 1   订单号     41278 non-null  int64</span><br><span class="line"> 2   提交日期    41278 non-null  datetime64[ns]</span><br><span class="line"> 3   订单金额    41277 non-null  float64</span><br><span class="line">dtypes: datetime64[ns](1), float64(1), int64(2)</span><br><span class="line">memory usage: 1.3 MB</span><br><span class="line">None</span><br><span class="line">-----------------------INFO--------------------------------</span><br><span class="line">               会员ID           订单号           订单金额</span><br><span class="line">count  4.127800e+04  4.127800e+04   41277.000000</span><br><span class="line">mean   2.908415e+10  4.313583e+09     957.106694</span><br><span class="line">std    1.389468e+10  1.094572e+07    2478.560036</span><br><span class="line">min    8.100000e+01  4.282026e+09       0.100000</span><br><span class="line">25%    1.934990e+10  4.309457e+09      59.000000</span><br><span class="line">50%    3.730339e+10  4.317545e+09     147.000000</span><br><span class="line">75%    3.923182e+10  4.321132e+09     888.000000</span><br><span class="line">max    3.954554e+10  4.324911e+09  174900.000000</span><br><span class="line">======================OVER===========================</span><br><span class="line">===============2017start======================================</span><br><span class="line">          会员ID         订单号       提交日期    订单金额</span><br><span class="line">0  38765290840  4324911135 2017-01-01  1799.0</span><br><span class="line">1  39305832102  4324911213 2017-01-01   369.0</span><br><span class="line">2  34190994969  4324911251 2017-01-01   189.0</span><br><span class="line">3  38986333210  4324911283 2017-01-01   169.0</span><br><span class="line">4      4271359  4324911355 2017-01-01    78.0</span><br><span class="line">----------------------HEAD----------------------------------</span><br><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 50839 entries, 0 to 50838</span><br><span class="line">Data columns (total 4 columns):</span><br><span class="line"> #   Column  Non-Null Count  Dtype</span><br><span class="line">---  ------  --------------  -----</span><br><span class="line"> 0   会员ID    50839 non-null  int64</span><br><span class="line"> 1   订单号     50839 non-null  int64</span><br><span class="line"> 2   提交日期    50839 non-null  datetime64[ns]</span><br><span class="line"> 3   订单金额    50839 non-null  float64</span><br><span class="line">dtypes: datetime64[ns](1), float64(1), int64(2)</span><br><span class="line">memory usage: 1.6 MB</span><br><span class="line">None</span><br><span class="line">-----------------------INFO--------------------------------</span><br><span class="line">               会员ID           订单号           订单金额</span><br><span class="line">count  5.083900e+04  5.083900e+04   50839.000000</span><br><span class="line">mean   2.882368e+10  4.332466e+09     963.587872</span><br><span class="line">std    1.409416e+10  4.404350e+06    2178.727261</span><br><span class="line">min    2.780000e+02  4.324911e+09       0.300000</span><br><span class="line">25%    1.869274e+10  4.328415e+09      59.000000</span><br><span class="line">50%    3.688044e+10  4.331989e+09     149.000000</span><br><span class="line">75%    3.923020e+10  4.337515e+09     898.000000</span><br><span class="line">max    3.954554e+10  4.338764e+09  123609.000000</span><br><span class="line">======================OVER===========================</span><br><span class="line">===============2018start======================================</span><br><span class="line">          会员ID         订单号       提交日期    订单金额</span><br><span class="line">0  39229691808  4338764262 2018-01-01  3646.0</span><br><span class="line">1  39293668916  4338764363 2018-01-01  3999.0</span><br><span class="line">2  35059646224  4338764376 2018-01-01    10.1</span><br><span class="line">3      1084397  4338770013 2018-01-01   828.0</span><br><span class="line">4      3349915  4338770121 2018-01-01  3758.0</span><br><span class="line">----------------------HEAD----------------------------------</span><br><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 81349 entries, 0 to 81348</span><br><span class="line">Data columns (total 4 columns):</span><br><span class="line"> #   Column  Non-Null Count  Dtype</span><br><span class="line">---  ------  --------------  -----</span><br><span class="line"> 0   会员ID    81349 non-null  int64</span><br><span class="line"> 1   订单号     81349 non-null  int64</span><br><span class="line"> 2   提交日期    81349 non-null  datetime64[ns]</span><br><span class="line"> 3   订单金额    81348 non-null  float64</span><br><span class="line">dtypes: datetime64[ns](1), float64(1), int64(2)</span><br><span class="line">memory usage: 2.5 MB</span><br><span class="line">None</span><br><span class="line">-----------------------INFO--------------------------------</span><br><span class="line">               会员ID           订单号           订单金额</span><br><span class="line">count  8.134900e+04  8.134900e+04   81348.000000</span><br><span class="line">mean   2.902317e+10  4.348372e+09     966.582792</span><br><span class="line">std    1.404116e+10  4.183774e+06    2204.969534</span><br><span class="line">min    2.780000e+02  4.338764e+09       0.000000</span><br><span class="line">25%    1.902755e+10  4.345654e+09      60.000000</span><br><span class="line">50%    3.740121e+10  4.349448e+09     149.000000</span><br><span class="line">75%    3.923380e+10  4.351639e+09     899.000000</span><br><span class="line">max    3.954614e+10  4.354235e+09  174900.000000</span><br><span class="line">======================OVER===========================</span><br><span class="line">===============会员等级start======================================</span><br><span class="line">          会员ID  会员等级</span><br><span class="line">0       100090     3</span><br><span class="line">1  10012905801     1</span><br><span class="line">2  10012935109     1</span><br><span class="line">3  10013498043     1</span><br><span class="line">4  10014087899     4</span><br><span class="line">----------------------HEAD----------------------------------</span><br><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 154385 entries, 0 to 154384</span><br><span class="line">Data columns (total 2 columns):</span><br><span class="line"> #   Column  Non-Null Count   Dtype</span><br><span class="line">---  ------  --------------   -----</span><br><span class="line"> 0   会员ID    154385 non-null  int64</span><br><span class="line"> 1   会员等级    154385 non-null  int64</span><br><span class="line">dtypes: int64(2)</span><br><span class="line">memory usage: 2.4 MB</span><br><span class="line">None</span><br><span class="line">-----------------------INFO--------------------------------</span><br><span class="line">               会员ID           会员等级</span><br><span class="line">count  1.543850e+05  154385.000000</span><br><span class="line">mean   2.980055e+10       2.259701</span><br><span class="line">std    1.365654e+10       1.346408</span><br><span class="line">min    8.100000e+01       1.000000</span><br><span class="line">25%    2.213894e+10       1.000000</span><br><span class="line">50%    3.833022e+10       2.000000</span><br><span class="line">75%    3.927932e+10       3.000000</span><br><span class="line">max    3.954614e+10       5.000000</span><br><span class="line">======================OVER===========================</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>结果说明<ul>
<li>每个sheet中的数据都能正常读取，无任何错误</li>
<li>日期列（提交日期）已经被自动识别为日期格式，后期不必转换</li>
<li>订单金额的分布是不均匀的，里面有明显的极大值<ul>
<li>例如2016年的数据中，最大值为174900，最小值仅为0.1</li>
<li>极大极小值相差过大，数据会受极值影响</li>
</ul>
</li>
<li>订单金额中的最小值包括0、0.1这样的金额，可能为非正常订单，与业务方沟通后确认<ul>
<li>最大值的订单金额有效，通常是客户一次性购买多个大家电商品</li>
<li>而订单金额为0.1元这类使用优惠券支付的订单，没有实际意义</li>
<li>除此之外，所有低于1元的订单均有这个问题，因此需要在后续处理中去掉</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-2-2-数据处理"><a href="#3-2-2-数据处理" class="headerlink" title="3.2.2 数据处理"></a>3.2.2 数据处理</h3><ul>
<li>有的表中存在缺失值记录，但数量不多，选择丢弃或填充均可</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为处理方便将2015~2018年销售数据合并到一起，采用concat竖向合并；因为索引不同，不同年份；列名相同</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sheet_names[:-<span class="number">1</span>]:</span><br><span class="line">    sheet_datas[i] = sheet_datas[i].dropna()</span><br><span class="line">    sheet_datas[i] = sheet_datas[i][sheet_datas[i][<span class="string">&#x27;订单金额&#x27;</span>] &gt; <span class="number">1</span>]<span class="comment"># 丢弃订单金额&lt;=1的记录</span></span><br><span class="line">    sheet_datas[i][<span class="string">&#x27;max_year_date&#x27;</span>] = sheet_datas[i][<span class="string">&#x27;提交日期&#x27;</span>].<span class="built_in">max</span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sheet_names:</span><br><span class="line">    <span class="built_in">print</span>(sheet_datas[i].isnull().<span class="built_in">sum</span>())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">会员ID             0</span><br><span class="line">订单号              0</span><br><span class="line">提交日期             0</span><br><span class="line">订单金额             0</span><br><span class="line">max_year_date    0</span><br><span class="line">dtype: int64</span><br><span class="line">会员ID             0</span><br><span class="line">订单号              0</span><br><span class="line">提交日期             0</span><br><span class="line">订单金额             0</span><br><span class="line">max_year_date    0</span><br><span class="line">dtype: int64</span><br><span class="line">会员ID             0</span><br><span class="line">订单号              0</span><br><span class="line">提交日期             0</span><br><span class="line">订单金额             0</span><br><span class="line">max_year_date    0</span><br><span class="line">dtype: int64</span><br><span class="line">会员ID             0</span><br><span class="line">订单号              0</span><br><span class="line">提交日期             0</span><br><span class="line">订单金额             0</span><br><span class="line">max_year_date    0</span><br><span class="line">dtype: int64</span><br><span class="line">会员ID    0</span><br><span class="line">会员等级    0</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-2-3-汇总所有数据"><a href="#3-2-3-汇总所有数据" class="headerlink" title="3.2.3 汇总所有数据"></a>3.2.3 汇总所有数据</h3><ul>
<li>为了后续计算方便， 我们将2015~2018年的销售数据合并到同一个DataFrame中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data_merge = sheet_datas[<span class="string">&#x27;2015&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sheet_names[<span class="number">1</span>:-<span class="number">1</span>]:</span><br><span class="line">    data_merge =data_merge.append(sheet_datas[i])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_merge</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_merge[<span class="string">&#x27;max_year_date&#x27;</span>].value_counts()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>查看合并后每年的数据情况</p>
<p>  2018-12-31    80801<br>  2017-12-31    50451<br>  2016-12-31    41001<br>  2015-12-31    30574<br>  Name: max_year_date, dtype: int64</p>
</li>
<li><p>与原始数据对比， 确认合并无误</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sheet_datas[<span class="string">&#x27;2018&#x27;</span>].shape</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(80801, 5)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>查看合并后的数据字段信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_merge.info()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">Int64Index: 202827 entries, 0 to 81348</span><br><span class="line">Data columns (total 5 columns):</span><br><span class="line"> #   Column         Non-Null Count   Dtype</span><br><span class="line">---  ------         --------------   -----</span><br><span class="line"> 0   会员ID           202827 non-null  int64</span><br><span class="line"> 1   订单号            202827 non-null  int64</span><br><span class="line"> 2   提交日期           202827 non-null  datetime64[ns]</span><br><span class="line"> 3   订单金额           202827 non-null  float64</span><br><span class="line"> 4   max_year_date  202827 non-null  datetime64[ns]</span><br><span class="line">dtypes: datetime64[ns](2), float64(1), int64(2)</span><br><span class="line">memory usage: 9.3 MB</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>汇总所有数据: 由于4年的数据列名都一样，所以使用append方法将4年数据合并为一个完整的dataframe data_merge，后续的所有计算都能基于同一个dataframe进行，而不用写循环代码段对每个年份的数据单独计算</li>
</ul>
<h3 id="3-2-4-以年为周期计算RFM"><a href="#3-2-4-以年为周期计算RFM" class="headerlink" title="3.2.4 以年为周期计算RFM"></a>3.2.4 以年为周期计算RFM</h3><p>获取各自年份数据:</p>
<ul>
<li>先计算各自年份的最大日期与每个行的日期的差，得到日期间隔</li>
<li>再增加一列新的字段，为每个记录行发生的年份，使用data_merge[‘提交日期’].dt.year实现</li>
<li>转换日期间隔为数字：data_merge[‘date_interval’].apply(lambda x: x.days) 是将data_merge[‘date_interval’]的时间间隔转换为数值型计算对象，这里使用了apply方法。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data_merge[<span class="string">&#x27;date_interval&#x27;</span>] = data_merge[<span class="string">&#x27;max_year_date&#x27;</span>]-data_merge[<span class="string">&#x27;提交日期&#x27;</span>]</span><br><span class="line">data_merge[<span class="string">&#x27;year&#x27;</span>] = data_merge[<span class="string">&#x27;提交日期&#x27;</span>].dt.year</span><br><span class="line"><span class="comment"># 转换日期间隔为数字</span></span><br><span class="line">data_merge[<span class="string">&#x27;date_interval&#x27;</span>] = data_merge[<span class="string">&#x27;date_interval&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.days)</span><br><span class="line">data_merge.head()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>基本添加了时间间隔以及年份字段之后， 我们就可以计算r, f,m的原始数据了</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按会员ID做汇总</span></span><br><span class="line">rfm_gb = data_merge.groupby([<span class="string">&#x27;year&#x27;</span>,<span class="string">&#x27;会员ID&#x27;</span>],as_index=<span class="literal">False</span>).agg(</span><br><span class="line">    &#123;<span class="string">&#x27;date_interval&#x27;</span>: <span class="string">&#x27;min&#x27;</span>,  <span class="comment"># 计算最近一次订单时间</span></span><br><span class="line">     <span class="string">&#x27;提交日期&#x27;</span>: <span class="string">&#x27;count&#x27;</span>, <span class="comment"># 计算订单频率</span></span><br><span class="line">     <span class="string">&#x27;订单金额&#x27;</span>: <span class="string">&#x27;sum&#x27;</span>&#125;)  <span class="comment"># 计算订单总金额</span></span><br><span class="line"><span class="comment"># 重命名列名</span></span><br><span class="line">rfm_gb.columns =  [<span class="string">&#x27;year&#x27;</span>,<span class="string">&#x27;会员ID&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>]</span><br><span class="line">rfm_gb.head()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>上面代码框中的第一行代码，是基于年份和会员ID，分别做RFM原始值的聚合计算</li>
<li>这里使用groupby，对year和会员ID进行分组，设置as_index&#x3D;False意味着year和会员ID不作为index列，而是作为结果列。后面使用agg方法实现了对date_interval、提交日期、订单金额三列分别以min、count、sum做聚合计算</li>
</ul>
<h3 id="3-2-5-RFM区间划分并保存RFM标签"><a href="#3-2-5-RFM区间划分并保存RFM标签" class="headerlink" title="3.2.5 RFM区间划分并保存RFM标签"></a>3.2.5 RFM区间划分并保存RFM标签</h3><ul>
<li>在做RFM划分时，基本逻辑是分别对R、F、M做离散化操作，然后再计算RFM。</li>
<li>在做RFM划分之前，先看下数据的基本分布状态</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看数据分布</span></span><br><span class="line">desc_pd = rfm_gb.iloc[:,<span class="number">2</span>:].describe().T</span><br><span class="line">desc_pd</span><br></pre></td></tr></table></figure>

<ul>
<li>从describe结果看出<ul>
<li>汇总后的数据总共有14万条</li>
<li>r和m的数据分布相对较为离散，表现在min、25%、50%、75%和max的数据没有特别集中</li>
<li>而从f（购买频率）则可以看出，大部分用户的分布都趋近于1，表现是从min到75%的分段值都是1且mean（均值）才为1.365</li>
<li>计划选择25%和75%作为区间划分的2个边界值</li>
</ul>
</li>
<li>f的分布情况说明<ul>
<li>r和m本身能较好地区分用户特征，而f则无法区分（大量的用户只有1个订单）</li>
<li>行业属性（家电）原因，1年购买1次比较普遍（其中包含新客户以及老客户在当年的第1次购买）</li>
<li>与业务部门沟通，划分时可以使用2和5来作为边界<ul>
<li>业务部门认为当年购买&gt;&#x3D;2次可被定义为复购用户（而非累计订单的数量计算复购用户）</li>
<li>业务部门认为普通用户购买5次已经是非常高的次数，超过该次数就属于非常高价值用户群体</li>
<li>该值是基于业务经验和日常数据报表获得的</li>
</ul>
</li>
</ul>
</li>
<li>区间边界的基本原则如下<ul>
<li>中间2个边界值：r和m是分别通过25%和75%的值获取的，f是业务与数据部门定义的。</li>
<li>最小值边界：比各个维度的最小值小即可。</li>
<li>最大值边界：大于等于各个维度的最大值即可</li>
<li>最小值边界为什么要小于各个维度的最小值:<ul>
<li>这是由于在边界上的数据归属有一个基本准则，要么属于区间左侧，要么属于区间右侧。如，f_bins中的2处于边界上，要么属于左侧区间，要么属于右侧区间</li>
<li>在后续使用pd.cut方法中，对于自定义边界实行的是左开右闭的原则，即数据属于右侧区间，f_bins中的2就属于右侧区间。最左侧的值是无法划分为任何区间的，因此，在定义最小值时，一定要将最小值的边界值</li>
<li>举例：[1，2，3，4，5]，假如数据划分的区间边界是[1，3，5]，即划分为2份<ul>
<li>其中的2&#x2F;3被划分到(1，3]区间中</li>
<li>3&#x2F;4&#x2F;5被划分到(3，5]区间中</li>
<li>1无法划分到任何一个正常区间内</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义区间边界</span></span><br><span class="line">r_bins = [-<span class="number">1</span>,<span class="number">79</span>,<span class="number">255</span>,<span class="number">365</span>] <span class="comment"># 注意起始边界小于最小值</span></span><br><span class="line">f_bins = [<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">130</span>]</span><br><span class="line">m_bins = [<span class="number">0</span>,<span class="number">69</span>,<span class="number">1199</span>,<span class="number">206252</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>RFM 划分计算</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RFM分箱得分</span></span><br><span class="line">rfm_gb[<span class="string">&#x27;r_score&#x27;</span>] = pd.cut(rfm_gb[<span class="string">&#x27;r&#x27;</span>], r_bins, labels=[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(r_bins)-<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>)])  <span class="comment"># 计算R得分</span></span><br><span class="line">rfm_gb[<span class="string">&#x27;f_score&#x27;</span>] = pd.cut(rfm_gb[<span class="string">&#x27;f&#x27;</span>], f_bins, labels=[i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(f_bins)-<span class="number">1</span>)])  <span class="comment"># 计算F得分</span></span><br><span class="line">rfm_gb[<span class="string">&#x27;m_score&#x27;</span>] = pd.cut(rfm_gb[<span class="string">&#x27;m&#x27;</span>], m_bins, labels=[i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m_bins)-<span class="number">1</span>)])  <span class="comment"># 计算M得分</span></span><br></pre></td></tr></table></figure>

<ul>
<li>每个rfm的过程使用了pd.cut方法，基于自定义的边界区间做划分</li>
<li>labels用来显示每个离散化后的具体值。F和M的规则是值越大，等级越高</li>
<li>而R的规则是值越小，等级越高，因此labels的规则与F和M相反</li>
<li>在labels指定时需要注意，4个区间的结果是划分为3份</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rfm_gb</span><br></pre></td></tr></table></figure>

<ul>
<li>将rfm值合并得到rfm标签</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#计算RFM组合</span></span><br><span class="line">rfm_gb[<span class="string">&#x27;r_score&#x27;</span>] = rfm_gb[<span class="string">&#x27;r_score&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line">rfm_gb[<span class="string">&#x27;f_score&#x27;</span>] = rfm_gb[<span class="string">&#x27;f_score&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line">rfm_gb[<span class="string">&#x27;m_score&#x27;</span>] = rfm_gb[<span class="string">&#x27;m_score&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line">rfm_gb[<span class="string">&#x27;rfm_group&#x27;</span>] = rfm_gb[<span class="string">&#x27;r_score&#x27;</span>].<span class="built_in">str</span>.cat(rfm_gb[<span class="string">&#x27;f_score&#x27;</span>]).<span class="built_in">str</span>.cat(rfm_gb[<span class="string">&#x27;m_score&#x27;</span>])</span><br></pre></td></tr></table></figure>

<ul>
<li>将3列作为字符串组合为新的分组<ul>
<li>代码中，先针对3列使用astype方法将数值型转换为字符串型</li>
<li>然后使用pandas的字符串处理库str中的cat方法做字符串合并，该方法可以将右侧的数据合并到左侧</li>
<li>再连续使用两个str.cat方法得到总的R、F、M字符串组合</li>
</ul>
</li>
<li>Series.str.cat(others&#x3D;None, sep&#x3D;None, na_rep&#x3D;None)<ul>
<li>参数:</li>
<li>others : 列表或复合列表,默认为None,如果为None则连接本身的元素</li>
<li>sep : 字符串 或者None,默认为None</li>
<li>na_rep : 字符串或者 None, 默认 None。如果为None缺失值将被忽略。</li>
<li>返回值: concat : 序列(Series)&#x2F;索引(Index)&#x2F;字符串(str)</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rfm_gb</span><br></pre></td></tr></table></figure>

<ul>
<li>保存RFM结果到Excel</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rfm_gb.to_excel(<span class="string">&#x27;sales_rfm_score1.xlsx&#x27;</span>)  <span class="comment"># 保存数据为Excel</span></span><br></pre></td></tr></table></figure>

<ul>
<li>保存结果到数据库</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="comment"># 创建数据库引擎，传入uri规则的字符串</span></span><br><span class="line">engine = create_engine(<span class="string">&#x27;mysql+pymysql://用户名:密码@IP地址:端口/数据库名字?charset=utf8&#x27;</span>)</span><br><span class="line">rfm_gb.to_sql(<span class="string">&#x27;rfm&#x27;</span>,engine)</span><br><span class="line">============================</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对密码编码（@ -&gt; %40）</span></span><br><span class="line">password = <span class="string">&quot;@Zz1423231563&quot;</span></span><br><span class="line">encoded_password = quote_plus(password)  <span class="comment"># 输出 &quot;%40Zz1423231563&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建引擎，# 创建和Mysql之间的连接，因为是端口映射，127.0.0.1是本地主机地址，33060是本地映射端口，work2是虚拟机上mysql的数据库k</span></span><br><span class="line">engine = create_engine(</span><br><span class="line">    <span class="string">f&quot;mysql+pymysql://root:<span class="subst">&#123;encoded_password&#125;</span>@127.0.0.1:33060/work2?charset=utf8mb4&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># 将数据转换为sql型</span></span><br><span class="line">rfm_result.to_sql(<span class="string">&#x27;rfm&#x27;</span>,engine)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取数据</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"></span><br><span class="line">password = <span class="string">&quot;@Zz1423231563&quot;</span></span><br><span class="line">encoded_pwd = quote_plus(password)  <span class="comment"># 编码特殊字符</span></span><br><span class="line"></span><br><span class="line">engine = create_engine(</span><br><span class="line">    <span class="string">f&quot;mysql+pymysql://root:<span class="subst">&#123;encoded_pwd&#125;</span>@127.0.0.1:33060/work2?charset=utf8mb4&quot;</span>,</span><br><span class="line">    connect_args=&#123;<span class="string">&quot;connect_timeout&quot;</span>: <span class="number">10</span>&#125;  <span class="comment"># 增加超时设置</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有数据库</span></span><br><span class="line">df_databases = pd.read_sql(<span class="string">&quot;SHOW DATABASES;&quot;</span>, engine)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;所有数据库:\n&quot;</span>, df_databases)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-6-RFM数据可视化"><a href="#3-2-6-RFM数据可视化" class="headerlink" title="3.2.6 RFM数据可视化"></a>3.2.6 RFM数据可视化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 图形数据汇总</span></span><br><span class="line">display_data = rfm_gb.groupby([<span class="string">&#x27;rfm_group&#x27;</span>,<span class="string">&#x27;year&#x27;</span>],as_index=<span class="literal">False</span>)[<span class="string">&#x27;会员ID&#x27;</span>].count()</span><br><span class="line">display_data.columns = [<span class="string">&#x27;rfm_group&#x27;</span>,<span class="string">&#x27;year&#x27;</span>,<span class="string">&#x27;number&#x27;</span>]</span><br><span class="line">display_data[<span class="string">&#x27;rfm_group&#x27;</span>] = display_data[<span class="string">&#x27;rfm_group&#x27;</span>].astype(<span class="built_in">int</span>)</span><br><span class="line">display_data.head()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyecharts.charts <span class="keyword">import</span> Bar3D</span><br><span class="line"><span class="keyword">from</span> pyecharts <span class="keyword">import</span> options <span class="keyword">as</span> opts</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyecharts.commons.utils <span class="keyword">import</span> JsCode</span><br><span class="line">range_color = [<span class="string">&#x27;#313695&#x27;</span>, <span class="string">&#x27;#4575b4&#x27;</span>, <span class="string">&#x27;#74add1&#x27;</span>, <span class="string">&#x27;#abd9e9&#x27;</span>, <span class="string">&#x27;#e0f3f8&#x27;</span>, <span class="string">&#x27;#ffffbf&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;#fee090&#x27;</span>, <span class="string">&#x27;#fdae61&#x27;</span>, <span class="string">&#x27;#f46d43&#x27;</span>, <span class="string">&#x27;#d73027&#x27;</span>, <span class="string">&#x27;#a50026&#x27;</span>]</span><br><span class="line">range_max = <span class="built_in">int</span>(display_data[<span class="string">&#x27;number&#x27;</span>].<span class="built_in">max</span>())</span><br><span class="line">c = (</span><br><span class="line">    Bar3D()<span class="comment">#设置了一个3D柱形图对象</span></span><br><span class="line">    .add(</span><br><span class="line">        <span class="string">&quot;&quot;</span>,<span class="comment">#标题</span></span><br><span class="line">        [d.tolist() <span class="keyword">for</span> d <span class="keyword">in</span> display_data.values],<span class="comment">#数据</span></span><br><span class="line">        xaxis3d_opts=opts.Axis3DOpts( type_=<span class="string">&quot;category&quot;</span>,name=<span class="string">&#x27;分组名称&#x27;</span>),<span class="comment">#x轴数据类型，名称</span></span><br><span class="line">        yaxis3d_opts=opts.Axis3DOpts( type_=<span class="string">&quot;category&quot;</span>,name=<span class="string">&#x27;年份&#x27;</span>),<span class="comment">#y轴数据类型，名称</span></span><br><span class="line">        zaxis3d_opts=opts.Axis3DOpts(type_=<span class="string">&quot;value&quot;</span>,name=<span class="string">&#x27;会员数量&#x27;</span>),<span class="comment">#z轴数据类型，名称</span></span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line">    .set_global_opts(<span class="comment">#设置颜色，及不同取值对应的颜色</span></span><br><span class="line">        visualmap_opts=opts.VisualMapOpts(max_=range_max,range_color=range_color),</span><br><span class="line">        title_opts=opts.TitleOpts(title=<span class="string">&quot;RFM分组结果&quot;</span>))<span class="comment">#设置标题</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"><span class="comment"># 生成html文件，查看数据图标</span></span><br><span class="line">c.render(<span class="string">&#x27;rfm_bar3d.html&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
              <a href="/tags/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90/" rel="tag"># 数据处理与统计分析</a>
              <a href="/tags/jupyterlab/" rel="tag"># jupyterlab</a>
              <a href="/tags/Pandas/" rel="tag"># Pandas</a>
              <a href="/tags/Matplotlib/" rel="tag"># Matplotlib</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/05/13/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%201ec3311af3f5801682d5fc9c085d70e9/%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A4%84%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%201f33311af3f5802b90facb7034b6b30f/" rel="prev" title="日期时间类型数据的处理与数据可视化">
                  <i class="fa fa-angle-left"></i> 日期时间类型数据的处理与数据可视化
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/05/16/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%201ec3311af3f5801682d5fc9c085d70e9/%E7%BB%83%E4%B9%A0%E4%BB%A5%E5%8F%8A%E6%80%BB%E7%BB%93%201f53311af3f58001a1fbd8c2ea0e7d8f/" rel="next" title="练习以及总结">
                  练习以及总结 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">cokeiz</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
